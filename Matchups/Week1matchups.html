<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Week 1 Matchups</title>
  <link rel="stylesheet" href="../style.css" />
  <script>
    const matchups = [
      ["Supercheese", "DGreatOOOOZZZZ"],
      ["Challito", "Menudo"],
      ["Jeff", "RedBanana"],
      ["Arby", "MrPig"],
      ["Harovo", "Mater"]
    ];

    async function getTotalPoints(player) {
      const response = await fetch(`https://script.google.com/macros/s/AKfycbz8WpIkW-XtGJ1_Yox6HeMfdI2vbGsjbAvy0RRryKuPKabyxsHSEkX3-0HHH-CVUzkLtw/exec?sheet=${player}`);
      const data = await response.json();

      const activeOperators = ["Thermite", "Sledge", "Mute", "Smoke"];
      let total = 0;
      activeOperators.forEach(op => {
        const stats = data.find(row => row.Operator === op);
        if (!stats) return;
        const kills = parseFloat(stats.Kills) || 0;
        const deaths = parseFloat(stats.Deaths) || 0;
        const hsPercent = parseFloat(stats["Headshot %"]) || 0;
        const assists = parseFloat(stats.Assist) || 0;
        const aces = parseFloat(stats.Aces) || 0;
        const teamKills = parseFloat(stats["Team Kills"]) || 0;
        const kd = deaths === 0 ? kills : kills / deaths;
        const headshots = Math.round(hsPercent);
        const points = (kd * 100) + (headshots * 5) + assists + (aces * 50) - (teamKills * 50);
        total += points;
      });
      return Math.round(total);
    }

    async function displayMatchups() {
      const table = document.querySelector("#matchups tbody");
      table.innerHTML = "";

      for (const [player1, player2] of matchups) {
        const [points1, points2] = await Promise.all([
          getTotalPoints(player1),
          getTotalPoints(player2)
        ]);

        const chance1 = Math.floor(Math.random() * 51) + 25; // 25-75
        const chance2 = 100 - chance1;

        const row = `
          <tr>
            <td><a href="./player.html?sheet=${player1}">${player1}</a></td>
            <td>${points1}</td>
            <td>${chance1}%</td>
            <td>vs</td>
            <td><a href="./player.html?sheet=${player2}">${player2}</a></td>
            <td>${points2}</td>
            <td>${chance2}%</td>
          </tr>`;

        table.innerHTML += row;
      }
    }

    window.onload = displayMatchups;
  </script>
</head>
<body>
  <header>
    <h1>Week 1 Matchups</h1>
    <a href="../index.html">Back to Homepage</a>
  </header>

  <section>
    <table id="matchups">
      <thead>
        <tr>
          <th>Player</th>
          <th>Total Points</th>
          <th>Chance of Winning</th>
          <th></th>
          <th>Player</th>
          <th>Total Points</th>
          <th>Chance of Winning</th>
        </tr>
      </thead>
      <tbody>
        <!-- Filled by JS -->
      </tbody>
    </table>
  </section>
</body>
</html>
